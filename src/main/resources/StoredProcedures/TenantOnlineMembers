create or replace function TenantOnlineMembersProcedure()
returns
table(
    system_user_global_id uuid,
    first_name varchar,
    last_name varchar,
    primary_phone text,
    primary_email varchar,
	login_status text,
	login_date text
) as '
begin
return query
SELECT
system_user.system_user_global_id,
system_user.first_name,
system_user.last_name,
REPLACE(system_user.primary_phone, ''+256'', ''0'') AS primary_phone,
system_user.primary_email,
CASE WHEN system_user.ever_logged_in = 1 THEN ''Yes'' ELSE ''No'' end AS login_status,
COALESCE(TO_CHAR(system_user.log_in_date,''DD-MM-YYYY HH12:MI:SS''), ''-'') AS login_date
FROM system_user
WHERE is_staff =0 ;
end;
'
language plpgsql