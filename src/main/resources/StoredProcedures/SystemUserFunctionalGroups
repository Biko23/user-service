create or replace function SystemUserFunctionalGroupsProcedure()
returns
table(
system_user_global_id uuid,
system_user_functional_group_mapping_global_id uuid,
functional_group_global_id uuid,
functional_group_name varchar,
first_name varchar,
middle_name varchar,
last_name varchar,
primary_phone varchar,
primary_email varchar
) as '

begin

return query
SELECT
system_user.system_user_global_id,
system_user_functional_group_mapping.system_user_functional_group_mapping_global_id,
system_user_functional_group_mapping.functional_group_global_id,
functional_group.name AS functional_group_name,
system_user.first_name,
system_user.middle_name,
system_user.last_name,
system_user.primary_phone,
system_user.primary_email
FROM
system_user,system_user_functional_group_mapping
LEFT JOIN functional_group ON functional_group.functional_group_global_id = system_user_functional_group_mapping.functional_group_global_id
WHERE
system_user.system_user_global_id = system_user_functional_group_mapping.system_user_global_id
AND
system_user.is_staff = 1;

end;
'
language plpgsql